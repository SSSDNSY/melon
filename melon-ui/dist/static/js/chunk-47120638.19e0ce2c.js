(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-47120638"],{"3ff8":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"流程名称",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入流程名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.name,callback:function(t){e.$set(e.queryParams,"name",t)},expression:"queryParams.name"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),s("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),s("el-row",{staticClass:"mb8",attrs:{gutter:10}},[s("el-col",{attrs:{span:1.5}},[s("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-edit",size:"mini",disabled:e.multiple},on:{click:e.openAssignee}},[e._v("修改办理人")])],1),s("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.dataList},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),s("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),s("el-table-column",{attrs:{align:"center",prop:"name",label:"任务名称"}}),s("el-table-column",{attrs:{align:"center",prop:"processDefinitionName",label:"流程定义名称"}}),s("el-table-column",{attrs:{align:"center",prop:"processDefinitionVersion",label:"版本号",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" v"+e._s(s.processDefinitionVersion)+".0")]}}])}),s("el-table-column",{attrs:{align:"center",prop:"startUserNickName",label:"流程发起人","min-width":"80"}}),s("el-table-column",{attrs:{align:"center",prop:"assignee",label:"当前流程办理人","min-width":"80"}}),s("el-table-column",{attrs:{align:"center",prop:"isSuspended",label:"流程状态",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["激活"==t.row.processStatus?s("el-tag",{attrs:{type:"success"}},[e._v("激活")]):s("el-tag",{attrs:{type:"danger"}},[e._v("挂起")])]}}])}),s("el-table-column",{attrs:{align:"center",prop:"businessKey","show-overflow-tooltip":!0,label:"流程关联业务ID",width:"160"}}),s("el-table-column",{attrs:{align:"center",prop:"createTime",label:"创建时间",width:"160"}}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-row",{staticClass:"mb8",attrs:{gutter:20}},[s("el-col",{attrs:{span:1.5}},[s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-tickets"},on:{click:function(s){return e.clickHistPop(t.row)}}},[e._v("审批记录")])],1),s("el-col",{attrs:{span:1.5}},[t.row.multiInstance&&null===t.row.parentTaskId?s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-tickets"},on:{click:function(s){return e.addMultiPeople(t.row)}}},[e._v("加签")]):e._e()],1)],1),s("el-row",{staticClass:"mb8",attrs:{gutter:20}},[s("el-col",{attrs:{span:1.5}},[null===t.row.parentTaskId?s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-tickets"},on:{click:function(s){return e.getInstVariable(t.row)}}},[e._v("流程变量")]):e._e()],1),s("el-col",{attrs:{span:1.5}},[t.row.taskVoList&&t.row.taskVoList.length>0&&null===t.row.parentTaskId?s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-tickets"},on:{click:function(s){return e.deleteMultiClick(t.row)}}},[e._v("减签")]):e._e()],1)],1)]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),e.visible?s("el-dialog",{attrs:{title:"审批记录",visible:e.visible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t}}},[s("history",{attrs:{processInstanceId:e.processInstanceId,editMessage:!0}})],1):e._e(),s("sys-dept-user",{ref:"userRef",attrs:{multiple:!1},on:{confirmUser:e.clickUser}}),e.addMultiVisible?s("div",[s("multi-user",{ref:"addMultiUserRef",attrs:{taskId:e.taskId},on:{multiClose:e.multiClose,confirmUser:e.confirmAddMultiUser}})],1):e._e(),s("el-dialog",{attrs:{"close-on-click-modal":!1,title:"减签",visible:e.deleteMultiVisible,width:"700px","append-to-body":""},on:{"update:visible":function(t){e.deleteMultiVisible=t}}},[s("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.multiList},on:{"selection-change":e.handleSelectionMultiList}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{prop:"name",label:"任务名称",width:"200"}}),s("el-table-column",{attrs:{prop:"assignee",label:"办理人",width:"200"}}),s("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{prop:"assigneeId",label:"办理人ID",width:"200"}})],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.deleteMultiSubmit()}}},[e._v("确定")]),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteMultiVisible=!1}}},[e._v("取消")])],1)],1),e.variableVisible?s("el-dialog",{attrs:{title:"流程变量",visible:e.variableVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.variableVisible=t}}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("流程定义名称："+e._s(e.processDefinitionName))])]),e._l(e.variableList,(function(t,i){return s("div",{key:i},[s("el-form",{attrs:{"label-position":"right","label-width":"200px"}},[s("el-form-item",{attrs:{label:t.key+"："}},[e._v(" "+e._s(t.value)+" ")])],1)],1)}))],2)],1):e._e()],1)},n=[],a=(s("d81d"),s("d3b7"),s("25f0"),s("a15b"),s("9a9d")),l=s("bbeb"),o=s("af6e"),r=s("15d4"),c=s("01e7"),u={components:{Back:o["a"],History:l["a"],SysDeptUser:r["default"],MultiUser:c["default"]},data:function(){return{buttonLoading:!1,loading:!0,exportLoading:!1,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,open:!1,dataList:[],queryParams:{pageNum:1,pageSize:10,name:void 0},taskId:void 0,task:{},taskVariables:void 0,variableVisible:!1,processInstanceId:void 0,businessKey:void 0,visible:!1,updateAssignee:{taskIdList:[],userId:void 0},isMultiInstance:!1,addMultiForm:{},deleteMultiForm:{},multiList:[],addMultiVisible:!1,deleteMultiVisible:!1,processDefinitionName:void 0,variableList:[]}},created:function(){this.getList()},methods:{handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.daterangeCreateTime=[],this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.single=1!==e.length,this.multiple=!e.length},getList:function(){var e=this;this.loading=!0,a["a"].getAllTaskWaitByPage(this.queryParams).then((function(t){e.dataList=t.rows,e.total=t.total,e.loading=!1}))},clickHistPop:function(e){this.processInstanceId=e.processInstanceId,this.visible=!0},openAssignee:function(){this.$refs.userRef.visible=!0},clickUser:function(e){var t=this;this.$modal.confirm("是否确认修改？").then((function(){var s=e.map((function(e){return e.userId}));t.loading=!0,t.updateAssignee.taskIdList=t.ids,t.updateAssignee.userId=s.toString(),t.$refs.userRef.visible=!1,a["a"].updateAssignee(t.updateAssignee).then((function(){t.$modal.msgSuccess("修改成功"),t.getList()}))}))},getInstVariable:function(e){var t=this;this.variableVisible=!0,this.processDefinitionName=e.processDefinitionName,a["a"].getProcessInstVariable(e.id).then((function(e){t.variableList=e.data}))},multiClose:function(){this.addMultiVisible=!1},addMultiPeople:function(e){var t=this;this.addMultiForm={},this.addMultiVisible=!0,this.taskId=e.id,this.$nextTick((function(){t.$refs.addMultiUserRef.visible=!0}))},confirmAddMultiUser:function(e){var t=this,s=e.map((function(e){return e.userId})),i=e.map((function(e){return e.nickName}));this.addMultiForm={taskId:this.taskId,assignees:s,assigneeNames:i,nickNames:i.join(",")},this.$forceUpdate(),this.$modal.confirm("是否确认加签？").then((function(){a["a"].addMultiInstanceExecution(t.addMultiForm).then((function(e){200===e.code&&(t.$message.success("办理成功"),t.addMultiForm={},t.visible=!1,t.addMultiVisible=!1,t.getList())})),t.$refs.addMultiUserRef.visible=!1}))},deleteMultiClick:function(e){this.multiList=e.taskVoList,this.deleteMultiVisible=!0},handleSelectionMultiList:function(e){var t=e.map((function(e){return e.executionId})),s=e.map((function(e){return e.id})),i=e.map((function(e){return e.assigneeId})),n=e.map((function(e){return e.assignee}));this.deleteMultiForm={taskId:this.taskId,taskIds:s,executionIds:t,assigneeIds:i,assigneeNames:n}},deleteMultiSubmit:function(){var e=this;this.$modal.confirm("是否确认减签？").then((function(){a["a"].deleteMultiInstanceExecution(e.deleteMultiForm).then((function(t){200===t.code&&(e.$message.success("办理成功"),e.visible=!1,e.deleteMultiVisible=!1,e.getList())}))}))}}},d=u,m=(s("528f"),s("2877")),p=Object(m["a"])(d,i,n,!1,null,"77bc9960",null);t["default"]=p.exports},"528f":function(e,t,s){"use strict";s("a878")},"538e":function(e,t,s){},a878:function(e,t,s){},bbeb:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-tabs",{attrs:{type:"border-card"}},[s("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{label:"审批意见"}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,border:"",stripe:"","max-height":"570"}},[s("el-table-column",{attrs:{label:"流程审批历史记录",align:"center"}},[s("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"50"}}),s("el-table-column",{attrs:{prop:"name",label:"任务名称",align:"center"}}),s("el-table-column",{attrs:{prop:"nickName",label:"办理人",align:"center"}}),s("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"}}),s("el-table-column",{attrs:{prop:"comment",label:"审批意见",align:"center"}}),s("el-table-column",{attrs:{prop:"startTime",label:"开始时间",align:"center"}}),s("el-table-column",{attrs:{prop:"endTime",label:"结束时间",align:"center"}}),e.editMessage?s("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.commentId?s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.handleClick(t.row)}}},[e._v("编辑意见")]):e._e()]}}],null,!1,2119452945)}):e._e()],1)],1)],1),s("el-tab-pane",{attrs:{label:"流程进度"}},[e.processInstanceId?s("el-image",{staticStyle:{"font-size":"20px",margin:"50px"},attrs:{src:e.url}},[s("div",{attrs:{slot:"placeholder"},slot:"placeholder"},[s("i",{staticClass:"el-icon-loading"}),e._v(" 流程审批历史图加载中……")])]):e._e()],1)],1),e.dialogVisible?s("el-dialog",{attrs:{title:"编辑意见","close-on-click-modal":!1,visible:e.dialogVisible,"append-to-body":"",width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-input",{attrs:{type:"textarea",maxlength:"300",placeholder:"请输入意见",autosize:{minRows:4},"show-word-limit":""},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickUpdate}},[e._v("确 定")]),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1):e._e()],1)},n=[],a=s("c7eb"),l=s("1da1"),o=s("e075"),r=s("9a9d"),c={props:{processInstanceId:String,editMessage:{type:Boolean,default:!1}},data:function(){return{loading:!1,url:null,list:[],dialogVisible:!1,commentId:void 0,comment:void 0}},watch:{processInstanceId:{handler:function(e,t){e&&(this.loading=!0,this.getHistoryInfoList(),this.url="/melon/workflow/processInstance/getHistoryProcessImage?processInstanceId="+e)},immediate:!0,deep:!0}},methods:{getHistoryInfoList:function(){var e=this;return Object(l["a"])(Object(a["a"])().mark((function t(){var s,i;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].getHistoryInfoList(e.processInstanceId);case 2:s=t.sent,i=s.data,e.list=i,e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},handleClick:function(e){this.commentId=e.commentId,this.comment=e.comment,this.dialogVisible=!0},clickUpdate:function(){var e=this;return Object(l["a"])(Object(a["a"])().mark((function t(){var s,i,n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r["a"].editComment(e.commentId,e.comment);case 2:s=t.sent,i=s.code,n=s.msg,200===i&&(e.$modal.msgSuccess(n),e.dialogVisible=!1,e.getHistoryInfoList());case 6:case"end":return t.stop()}}),t)})))()}}},u=c,d=(s("fb7f"),s("2877")),m=Object(d["a"])(u,i,n,!1,null,null,null);t["a"]=m.exports},e075:function(e,t,s){"use strict";var i=s("b775");t["a"]={startProcessApply:function(e){return Object(i["a"])({url:"/workflow/processInstance/startWorkFlow",method:"post",data:e})},getHistoryInfoList:function(e){return Object(i["a"])({url:"/workflow/processInstance/getHistoryInfoList/"+e,method:"get"})},getHistoryProcessImage:function(e){return"/melon"+"/workflow/processInstance/getHistoryProcessImage?processInstId=".concat(e,"&t=")+Math.random()},getInfoByBusinessKey:function(e){return Object(i["a"])({url:"/workflow/actBusiness/getInfoByBusinessKey/"+e,method:"get"})},getProcessInstRunningByPage:function(e){return Object(i["a"])({url:"/workflow/processInstance/getProcessInstRunningByPage",method:"get",params:e})},state:function(e){return Object(i["a"])({url:"/workflow/processInstance/state",method:"put",data:e})},deleteRuntimeProcessInst:function(e){return Object(i["a"])({url:"/workflow/processInstance/deleteRuntimeProcessInst/"+e,method:"delete"})},deleteRuntimeProcessAndHisInst:function(e){return Object(i["a"])({url:"/workflow/processInstance/deleteRuntimeProcessAndHisInst/"+e,method:"delete"})},deleteFinishProcessAndHisInst:function(e){return Object(i["a"])({url:"/workflow/processInstance/deleteFinishProcessAndHisInst/"+e,method:"delete"})},cancelProcessApply:function(e){return Object(i["a"])({url:"/workflow/processInstance/cancelProcessApply/"+e,method:"get"})},getProcessInstFinishByPage:function(e){return Object(i["a"])({url:"/workflow/processInstance/getProcessInstFinishByPage",method:"get",params:e})}}},fb7f:function(e,t,s){"use strict";s("538e")}}]);