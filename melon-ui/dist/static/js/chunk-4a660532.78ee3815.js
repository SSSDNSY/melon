(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a660532","chunk-232fa4ee","chunk-a7df7234","chunk-1c928ee9"],{2543:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"历史版本",visible:e.visible,width:"90%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},[i("div",{staticClass:"app-container"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),i("el-table-column",{attrs:{align:"center",prop:"name",label:"模型名称","min-width":"160"}}),i("el-table-column",{attrs:{align:"center",prop:"key",label:"标识Key","min-width":"120"}}),i("el-table-column",{attrs:{align:"center",prop:"version",label:"版本号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" v"+e._s(i.version)+".0")]}}])}),i("el-table-column",{attrs:{align:"center",prop:"resourceName",label:"流程XML","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-link",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.clickExportXML(n.id)}}},[e._v(e._s(n.resourceName))])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"diagramResourceName",label:"流程图片","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.clickPreviewImg(n.id)}}},[e._v(e._s(n.diagramResourceName))])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"suspensionState",label:"状态","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.suspensionState?i("el-tag",{attrs:{type:"success"}},[e._v("激活")]):i("el-tag",{attrs:{type:"danger"}},[e._v("挂起")])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"deploymentTime",label:"部署时间",width:"150"}}),i("el-table-column",{attrs:{align:"center",prop:"description","show-overflow-tooltip":!0,label:"挂起或激活原因",width:"150"}}),i("el-table-column",{attrs:{label:"操作",align:"center",width:"220","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-row",{staticClass:"mb8",attrs:{gutter:20}},[i("el-col",{attrs:{span:1.5}},[1==t.row.suspensionState?i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-lock"},on:{click:function(i){return e.openDialog(t.row)}}},[e._v("挂起")]):i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-unlock"},on:{click:function(i){return e.openDialog(t.row)}}},[e._v("激活")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-sort"},on:{click:function(i){return e.convertToModel(t.row)}}},[e._v("转换模型")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")])],1)],1),i("el-row",{staticClass:"mb8",attrs:{gutter:20}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-setting"},on:{click:function(i){return e.handleSetting(t.row)}}},[e._v("设置")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-copy-document"},on:{click:function(i){return e.copySetting(t.row)}}},[e._v("复制流程")])],1)],1)]}}])})],1),e.dialogVisible?i("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"挂起或激活流程","append-to-body":"","close-on-click-modal":!1,visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-input",{attrs:{type:"textarea",maxlength:"300",placeholder:"请输入原因",autosize:{minRows:4},"show-word-limit":""},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickUpdateProcDefState}},[e._v("确 定")])],1)],1):e._e(),i("process-preview",{ref:"previewRef",attrs:{url:e.url,type:e.type}}),i("process-setting",{ref:"settingRef"})],1)])},o=[],a=(i("d81d"),i("d3b7"),i("14d9"),i("a4d3"),i("e01a"),i("b0c0"),i("db18")),r=i("b2e1"),l=i("6d65"),s=i("74ce"),c=i("f322"),u=i("6282"),d={components:{processDeploy:l["default"],processPreview:s["default"],processSetting:c["default"]},props:{propKey:{type:String},definitionId:{type:String}},data:function(){return{dialogVisible:!1,description:"",visible:!1,url:[],buttonLoading:!1,loading:!0,exportLoading:!1,ids:[],single:!0,multiple:!0,showSearch:!0,open:!1,list:[],type:"",procedefData:{}}},methods:{handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.single=1!==e.length,this.multiple=!e.length},getList:function(e){var t=this;this.loading=!0,Object(a["d"])(e).then((function(e){t.list=e.data,t.loading=!1}))},convertToModel:function(e){var t=this;this.loading=!0,Object(u["b"])(e.id).then((function(i){if(200===i.code){t.$modal.msgSuccess("转换成功"),t.propKey=e.key,t.definitionId=e.id,t.$refs.hisListRef.visible=!0;var n={id:t.definitionId,key:t.propKey};t.getList(n),t.loading=!1}})).finally((function(){t.loading=!1}))},handleDelete:function(e){var t=this,i=e.deploymentId;this.$modal.confirm('是否确认删除标识key为"'+e.key+'"的数据项？').then((function(){return t.loading=!0,Object(a["a"])(i,e.id)})).then((function(){t.loading=!1;var e={id:t.definitionId,key:t.propKey};t.getList(e),t.$modal.msgSuccess("删除成功")})).finally((function(){t.loading=!1}))},clickExportXML:function(e){window.open("/melon/workflow/definition/export/xml/"+e)},clickPreviewImg:function(e){this.type="png",this.url.push("/melon/workflow/definition/export/png/"+e),this.$refs.previewRef.visible=!0},openDialog:function(e){this.procedefData=e,this.description=e.description,this.dialogVisible=!0},clickUpdateProcDefState:function(e){var t=this,i="";i=1===this.procedefData.suspensionState?"暂停后，此流程下的所有任务都不允许往后流转，您确定挂起【".concat(this.procedefData.name||this.procedefData.key,"】吗？"):"启动后，此流程下的所有任务都允许往后流转，您确定激活【".concat(this.procedefData.name||this.procedefData.key,"】吗？");var n={definitionId:this.procedefData.id,description:this.description};this.$modal.confirm(i).then((function(){return t.loading=!0,Object(a["g"])(n)})).then((function(){t.loading=!1;var e={id:t.definitionId,key:t.propKey};t.getList(e),t.$modal.msgSuccess("操作成功"),t.dialogVisible=!1})).finally((function(){t.loading=!1}))},handleSetting:function(e){var t=this;this.$nextTick((function(){t.$refs.settingRef.visible=!0,t.$refs.settingRef.init(e.id)}))},copySetting:function(e){var t=this;this.$modal.confirm("是否确认将此设置复制为最新？").then((function(){t.loading=!0,Object(r["b"])(e.id,e.key).then((function(e){200===e.code?t.$modal.msgSuccess("操作成功"):t.$modal.msgError(e.msg)}))})).finally((function(){t.loading=!1}))}}},f=d,p=i("2877"),m=Object(p["a"])(f,n,o,!1,null,null,null);t["default"]=m.exports},6048:function(e,t,i){"use strict";i("ac83")},6282:function(e,t,i){"use strict";i.d(t,"f",(function(){return o})),i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return l})),i.d(t,"b",(function(){return s})),i.d(t,"e",(function(){return c})),i.d(t,"h",(function(){return u})),i.d(t,"g",(function(){return d}));var n=i("b775");function o(e){return Object(n["a"])({url:"/workflow/model/list",method:"get",params:e})}function a(e){return Object(n["a"])({url:"/workflow/model",method:"post",data:e})}function r(e){return Object(n["a"])({url:"/workflow/model/"+e,method:"delete"})}function l(e){return Object(n["a"])({url:"/workflow/model/deploy/"+e,method:"post"})}function s(e){return Object(n["a"])({url:"/workflow/model/convertToModel/"+e,method:"put"})}function c(e){return Object(n["a"])({url:"workflow/model/getInfo/".concat(e,"/xml"),method:"get"})}function u(e){return Object(n["a"])({url:"workflow/model",method:"put",data:e})}function d(e){return Object(n["a"])({url:"model/newModel",method:"post",data:e})}},"6d65":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"部署流程文件",visible:e.visible,width:"400px"},on:{"update:visible":function(t){e.visible=t}}},[i("el-upload",{attrs:{accept:"application/zip,application/xml,.bpmn","http-request":e.deployProcessFile,drag:"",action:"","show-file-list":!1}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[i("em",[e._v("点击上传，选择BPMN流程文件")])]),i("div",{staticClass:"el-upload__text"},[e._v("仅支持 .zip、.bpmn20.xml、bpmn 格式文件")])])],1)},o=[],a=i("c7eb"),r=i("1da1"),l=i("db18"),s={data:function(){return{visible:!1,loading:!1}},methods:{deployProcessFile:function(e){var t=this;return Object(r["a"])(Object(a["a"])().mark((function i(){var n;return Object(a["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=new FormData,n.append("file",e.file),i.next=4,Object(l["b"])(n);case 4:t.$modal.msgSuccess("部署成功"),t.$parent.getList(),t.visible=!1;case 7:case"end":return i.stop()}}),i)})))()}}},c=s,u=i("2877"),d=Object(u["a"])(c,n,o,!1,null,null,null);t["default"]=d.exports},"74ce":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"预览",visible:e.visible,width:"70%","append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},["png"===e.type?i("div",{staticStyle:{align:"center"}},["png"===e.type?i("el-image",{attrs:{src:e.url[0]}},[i("div",{attrs:{slot:"placeholder"},slot:"placeholder"},[e._v("流程图加载中 "),i("i",{staticClass:"el-icon-loading"})])]):e._e()],1):e._e(),"xml"===e.type?i("div",{staticClass:"xml-data"},e._l(e.url,(function(t,n){return i("div",{key:n},[i("pre",{staticClass:"font"},[e._v(e._s(t))])])})),0):e._e(),"xml"===e.type?i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"copyText",attrs:{"data-clipboard-text":e.copyText,type:"primary",size:"mini"},on:{click:e.copy}},[e._v("复制")])],1):e._e()])},o=[],a=(i("a15b"),i("b311")),r=i.n(a),l={props:{url:{type:Array,default:function(){return[]}},type:String},data:function(){return{visible:!1,previewType:"xml",width:"450px",height:"300px",copyText:""}},methods:{copy:function(){var e=this,t=new r.a(".copyText");this.copyText=this.url.join(""),t.on("success",(function(i){e.$message.success("复制成功"),t.destroy()})),t.on("error",(function(i){e.$message.error("复制失败"),t.destroy()}))}}},s=l,c=(i("f92a"),i("2877")),u=Object(c["a"])(s,n,o,!1,null,null,null);t["default"]=u.exports},"82c8d":function(e,t,i){},ac83:function(e,t,i){},b855:function(e,t,i){"use strict";i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return r}));i("99af");var n=i("b775");function o(e){return Object(n["a"])({url:"/workflow/processDefSetting/getProcessDefSettingByDefId/"+e,method:"get"})}function a(e,t,i){return Object(n["a"])({url:"/workflow/processDefSetting/checkProcessDefSetting/".concat(e,"/").concat(t,"/").concat(i),method:"get"})}function r(e){return Object(n["a"])({url:"/workflow/processDefSetting",method:"post",data:e})}},c750:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("el-dialog",{attrs:{title:"表单",visible:e.visible,width:"60%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{ref:"formDataRef",attrs:{"label-width":"110px",model:e.formData,rules:e.rulesFrom}},[i("el-row",[i("el-col",{staticClass:"line",attrs:{span:12}},[i("el-form-item",{attrs:{label:"流程定义Key",prop:"processDefinitionKey"}},[i("el-input",{attrs:{disabled:""},model:{value:e.formData.processDefinitionKey,callback:function(t){e.$set(e.formData,"processDefinitionKey",t)},expression:"formData.processDefinitionKey"}})],1)],1),i("el-col",{staticClass:"line",attrs:{span:12}},[i("el-form-item",{attrs:{label:"流程定义名称",prop:"processDefinitionName"}},[i("el-input",{attrs:{disabled:""},model:{value:e.formData.processDefinitionName,callback:function(t){e.$set(e.formData,"processDefinitionName",t)},expression:"formData.processDefinitionName"}})],1)],1)],1),i("el-row",[i("el-col",{staticClass:"line",attrs:{span:24}},[i("el-form-item",{attrs:{label:"表单类型",prop:"businessType"}},[i("el-radio-group",{on:{change:function(t){return e.change(t)}},model:{value:e.formData.businessType,callback:function(t){e.$set(e.formData,"businessType",t)},expression:"formData.businessType"}},[i("el-radio",{attrs:{label:0,border:""}},[e._v("动态表单")]),i("el-radio",{attrs:{label:1,border:""}},[e._v("业务表单")])],1)],1)],1)],1),0===e.formData.businessType?i("el-row",[i("el-col",{staticClass:"line",attrs:{span:12}},[i("el-form-item",{attrs:{label:"表单Key",prop:"formKey"}},[i("el-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:e.formData.formKey,callback:function(t){e.$set(e.formData,"formKey",t)},expression:"formData.formKey"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handerOpenForm},slot:"append"})],1)],1)],1),i("el-col",{staticClass:"line",attrs:{span:12}},[i("el-form-item",{attrs:{label:"表单名称",prop:"formName"}},[i("el-input",{attrs:{disabled:""},model:{value:e.formData.formName,callback:function(t){e.$set(e.formData,"formName",t)},expression:"formData.formName"}})],1)],1)],1):e._e(),0===e.formData.businessType?i("el-row",[i("el-col",{staticClass:"line",attrs:{span:24}},[i("el-form-item",{attrs:{label:"表单参数"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入表单参数,动态表单中参数id,多个用英文逗号隔开"},on:{input:function(t){return e.change(t)}},model:{value:e.formData.formVariable,callback:function(t){e.$set(e.formData,"formVariable",t)},expression:"formData.formVariable"}})],1)],1)],1):e._e(),1===e.formData.businessType?i("el-row",[i("el-col",{staticClass:"line",attrs:{span:12}},[i("el-form-item",{attrs:{label:"组件名称",prop:"componentName"}},[i("el-input",{attrs:{placeholder:"请输入组件名称"},model:{value:e.formData.componentName,callback:function(t){e.$set(e.formData,"componentName",t)},expression:"formData.componentName"}})],1)],1)],1):e._e()],1),e.visible?i("el-dialog",{attrs:{title:"表单",visible:e.formVisible,width:"70%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.formVisible=t}}},[i("div",{staticClass:"app-container"},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"表单key",prop:"formKey"}},[i("el-input",{attrs:{placeholder:"请输入表单key",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.formKey,callback:function(t){e.$set(e.queryParams,"formKey",t)},expression:"queryParams.formKey"}})],1),i("el-form-item",{attrs:{label:"表单名称",prop:"formName"}},[i("el-input",{attrs:{placeholder:"请输入表单名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.formName,callback:function(t){e.$set(e.queryParams,"formName",t)},expression:"queryParams.formName"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"highlight-current-row":!0,data:e.dynamicFormList},on:{"row-click":e.handleChange}},[e._e(),i("el-table-column",{attrs:{label:"表单key",align:"center",prop:"formKey"}}),i("el-table-column",{attrs:{label:"表单名称",align:"center",prop:"formName"}}),i("el-table-column",{attrs:{label:"表单备注",align:"center",prop:"formRemark"}})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)]):e._e(),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formDataRef")}}},[e._v("确 定")])],1)],1):e._e()},o=[],a=i("d60a"),r=i("b855"),l={props:{formData:{type:Object,default:function(){}}},name:"DynamicFormList",data:function(){return{visible:!1,formVisible:!1,buttonLoading:!1,loading:!0,showSearch:!0,total:0,dynamicFormList:[],title:"",queryParams:{pageNum:1,pageSize:10,formKey:void 0,formName:void 0},rulesFrom:{processDefinitionKey:[{required:!0,message:"流程定义Key不能为空",trigger:"blur"}],processDefinitionName:[{required:!0,message:"流程定义名称不能为空",trigger:"blur"}],formKey:[{required:!0,message:"表单Key不能为空",trigger:"blur"}],formName:[{required:!0,message:"表单名称不能为空",trigger:"blur"}],businessType:[{required:!0,message:"业务类型不能为空",trigger:"blur"}],componentName:[{required:!0,message:"组件名称不能为空",trigger:"blur"}]}}},created:function(){},methods:{change:function(e){this.$forceUpdate(e),this.$refs["formDataRef"].clearValidate()},getList:function(){var e=this;this.loading=!0,Object(a["e"])(this.queryParams).then((function(t){e.dynamicFormList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleChange:function(e){this.$set(this.formData,"formId",e.id),this.$set(this.formData,"formKey",e.formKey),this.$set(this.formData,"formName",e.formName),this.formVisible=!1},handerOpenForm:function(){this.getList(),this.formVisible=!0},submitForm:function(e){var t=this;this.loading=!0,this.$refs[e].validate((function(e){if(e){var i="";i=0===t.formData.businessType?t.formData.formId:t.formData.componentName,Object(r["b"])(t.formData.processDefinitionId,i,t.formData.businessType).then((function(e){e.data?t.$confirm(e.msg,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.formData.ids=e.data,Object(r["a"])(t.formData).then((function(e){t.$modal.msgSuccess("保存成功"),t.loading=!1,t.visible=!1,t.$emit("callbackFn")}))})):Object(r["a"])(t.formData).then((function(e){t.$modal.msgSuccess("保存成功"),t.loading=!1,t.visible=!1,t.$emit("callbackFn")}))}))}}))}}},s=l,c=(i("6048"),i("2877")),u=Object(c["a"])(s,n,o,!1,null,"3cb2adb8",null);t["default"]=u.exports},d60a:function(e,t,i){"use strict";i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return l})),i.d(t,"f",(function(){return s})),i.d(t,"b",(function(){return c}));var n=i("b775");function o(e){return Object(n["a"])({url:"/workflow/dynamicForm/list",method:"get",params:e})}function a(e){return Object(n["a"])({url:"/workflow/dynamicForm/enableList",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/workflow/dynamicForm/"+e,method:"get"})}function l(e){return Object(n["a"])({url:"/workflow/dynamicForm",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/workflow/dynamicForm",method:"put",data:e})}function c(e){return Object(n["a"])({url:"/workflow/dynamicForm/"+e,method:"delete"})}},f92a:function(e,t,i){"use strict";i("82c8d")},fd42:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"模型名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入模型名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.name,callback:function(t){e.$set(e.queryParams,"name",t)},expression:"queryParams.name"}})],1),i("el-form-item",{attrs:{label:"标识Key",prop:"key"}},[i("el-input",{attrs:{placeholder:"请输入标识Key",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.key,callback:function(t){e.$set(e.queryParams,"key",t)},expression:"queryParams.key"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-button",{attrs:{icon:"el-icon-upload",size:"small",type:"primary"},on:{click:e.clickDeploy}},[e._v("部署流程文件")]),i("el-alert",{staticStyle:{margin:"10px 0"},attrs:{title:"说明：当有多个相同标识Key的流程时，只显示其最新版本流程。",type:"info","show-icon":"",closable:!1}}),i("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.dataList},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),i("el-table-column",{attrs:{fixed:"",align:"center",type:"index",label:"序号",width:"50"}}),i("el-table-column",{attrs:{fixed:"",align:"center",prop:"name",label:"模型名称","min-width":"160","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{align:"center",prop:"key",label:"标识Key","min-width":"120"}}),i("el-table-column",{attrs:{align:"center",prop:"version",label:"版本号",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" v"+e._s(i.version)+".0")]}}])}),i("el-table-column",{attrs:{align:"center",prop:"resourceName",label:"流程XML","min-width":"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-link",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.clickExportXML(n.id)}}},[e._v(e._s(n.resourceName))])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"diagramResourceName",label:"流程图片","min-width":"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.clickPreviewImg(n.id)}}},[e._v(e._s(n.diagramResourceName))])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"suspensionState",label:"状态","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.suspensionState?i("el-tag",{attrs:{type:"success"}},[e._v("激活")]):i("el-tag",{attrs:{type:"danger"}},[e._v("挂起")])]}}])}),i("el-table-column",{attrs:{align:"center",prop:"deploymentTime",label:"部署时间","show-overflow-tooltip":!0,width:"100"}}),i("el-table-column",{attrs:{align:"center",prop:"actProcessDefSettingVo.businessType",label:"表单Key",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.actProcessDefSettingVo&&0===t.row.actProcessDefSettingVo.businessType?i("el-tag",{attrs:{type:"success"}},[e._v("动态表单")]):t.row.actProcessDefSettingVo&&1===t.row.actProcessDefSettingVo.businessType?i("el-tag",{attrs:{type:"primary"}},[e._v("业务表单")]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",label:"表单Key/组件名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.actProcessDefSettingVo&&0===t.row.actProcessDefSettingVo.businessType?i("span",[e._v(e._s(t.row.actProcessDefSettingVo.formKey))]):e._e(),t.row.actProcessDefSettingVo&&1===t.row.actProcessDefSettingVo.businessType?i("span",[e._v(e._s(t.row.actProcessDefSettingVo.componentName))]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",prop:"description","show-overflow-tooltip":!0,label:"挂起或激活原因",width:"150"}}),i("el-table-column",{attrs:{label:"操作",align:"center",width:"210","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-row",{staticClass:"mb8",attrs:{gutter:20}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-sort"},on:{click:function(i){e.convertToModel(t.row)}}},[e._v("转换模型")])],1),i("el-col",{attrs:{span:1.5}},[1==t.row.suspensionState?i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-lock"},on:{click:function(i){return e.openDialog(t.row)}}},[e._v("挂起")]):i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-unlock"},on:{click:function(i){return e.openDialog(t.row)}}},[e._v("激活")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")])],1)],1),i("el-row",{staticClass:"mb8",attrs:{gutter:20}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-tickets"},on:{click:function(i){e.clickHisList(t.row)}}},[e._v("历史版本")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-setting"},on:{click:function(i){return e.handleSetting(t.row)}}},[e._v("设置")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-postcard"},on:{click:function(i){return e.handleForm(t.row)}}},[e._v("表单")])],1)],1)]}}])})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),e.dialogVisible?i("el-dialog",{attrs:{title:"挂起或激活流程","close-on-click-modal":!1,visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-input",{attrs:{type:"textarea",maxlength:"300",placeholder:"请输入原因",autosize:{minRows:4},"show-word-limit":""},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.buttonLoading,expression:"buttonLoading"}],attrs:{type:"primary",size:"small"},on:{click:e.clickUpdateProcDefState}},[e._v("确 定")]),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1):e._e(),i("process-deploy",{ref:"deployProcess"}),i("process-preview",{ref:"previewRef",attrs:{url:e.url,type:e.type}}),i("process-his-list",{ref:"hisListRef",attrs:{propKey:e.propKey,definitionId:e.definitionId}}),i("process-setting",{ref:"settingRef"}),i("process-form-list",{ref:"formRef",attrs:{formData:e.formData},on:{callbackFn:e.getList}})],1)},o=[],a=(i("d81d"),i("d3b7"),i("14d9"),i("a4d3"),i("e01a"),i("b0c0"),i("db18")),r=i("b855"),l=i("6282"),s=i("6d65"),c=i("74ce"),u=i("2543"),d=i("f322"),f=i("c750"),p={name:"Definition",components:{processDeploy:s["default"],processPreview:c["default"],processHisList:u["default"],processSetting:d["default"],processFormList:f["default"]},data:function(){return{dialogVisible:!1,description:"",url:[],propKey:null,definitionId:null,buttonLoading:!1,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,open:!1,dataList:[],queryParams:{pageNum:1,pageSize:10,name:void 0,key:void 0},settingVisible:!1,procedefData:{},type:"",formData:{}}},created:function(){this.getList()},methods:{handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.daterangeCreateTime=[],this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.single=1!==e.length,this.multiple=!e.length},convertToModel:function(e){var t=this;this.$modal.confirm("是否转换模型？").then((function(){return t.loading=!0,Object(l["b"])(e.id)})).then((function(){t.loading=!1,t.getList(),t.$modal.msgSuccess("转换成功")})).finally((function(){t.loading=!1}))},getList:function(){var e=this;this.loading=!0,Object(a["e"])(this.queryParams).then((function(t){e.dataList=t.rows,e.total=t.total,e.loading=!1}))},handleDelete:function(e){var t=this,i=e.deploymentId;this.$modal.confirm('是否确认删除标识key为"'+e.key+'"的数据项？').then((function(){return t.loading=!0,Object(a["a"])(i,e.id)})).then((function(){t.loading=!1,t.getList(),t.$modal.msgSuccess("删除成功")})).finally((function(){t.loading=!1}))},clickDeploy:function(){this.$refs.deployProcess.visible=!0},clickExportXML:function(e){var t=this;this.type="xml",Object(a["c"])(e).then((function(e){t.url=[],t.url=e.data,t.$refs.previewRef.visible=!0}))},clickPreviewImg:function(e){this.type="png",this.url=[],this.url.push("/melon/workflow/definition/export/png/"+e),this.$refs.previewRef.visible=!0},openDialog:function(e){this.procedefData=e,null===e.description?this.description="":this.description=e.description,this.dialogVisible=!0},clickUpdateProcDefState:function(){var e=this,t="";t=1===this.procedefData.suspensionState?"暂停后，此流程下的所有任务都不允许往后流转，您确定挂起【".concat(this.procedefData.name||this.procedefData.key,"】吗？"):"启动后，此流程下的所有任务都允许往后流转，您确定激活【".concat(this.procedefData.name||this.procedefData.key,"】吗？");var i={definitionId:this.procedefData.id,description:this.description};this.$modal.confirm(t).then((function(){return e.buttonLoading=!0,Object(a["g"])(i)})).then((function(){e.buttonLoading=!1,e.getList(),e.$modal.msgSuccess("操作成功"),e.dialogVisible=!1})).finally((function(){e.buttonLoading=!1}))},clickHisList:function(e){this.propKey=e.key,this.definitionId=e.id,this.$refs.hisListRef.visible=!0;var t={id:this.definitionId,key:this.propKey};this.$refs.hisListRef.getList(t)},handleSetting:function(e){var t=this;this.$nextTick((function(){t.$refs.settingRef.visible=!0,t.$refs.settingRef.init(e.id)}))},handleForm:function(e){var t=this;this.loading=!0,Object(r["c"])(e.id).then((function(i){t.formData={},i.data?t.formData=i.data:t.formData.businessType=0,t.formData.processDefinitionId=e.id,t.formData.processDefinitionKey=e.key,t.formData.processDefinitionName=e.name,t.loading=!1,t.$refs.formRef.visible=!0}))}}},m=p,h=i("2877"),b=Object(h["a"])(m,n,o,!1,null,null,null);t["default"]=b.exports}}]);