(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3cd96e50"],{"199b":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("container",{attrs:{type:"ghost"}},[o("div",{staticClass:"theme-tab-container"},[o("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,(function(t){return o("el-tab-pane",{key:t.id,attrs:{name:t.id+"",label:t.name}},[t.children&&t.children.length?o("div",{staticClass:"card-box"},e._l(t.children,(function(t,r){return o("div",{key:t.id,staticClass:"card-content",class:{"is-active":1==t.id},style:{background:e.colorList[r%e.colorList.length]},on:{click:function(o){return e.onChangeType(t.id)}}},[e._v(e._s(t.name)+" ")])})),0):o("div",{staticClass:"card-box-empty",attrs:{flex:"dir:top main:center cross:center"}},[o("i",{staticClass:"el-icon-search"}),o("span",[e._v("没有流程类型")])])])})),1)],1),o("div",{staticClass:"theme-main-container"},[o("div",[o("el-form",{ref:"form",attrs:{model:e.searchForm,"label-width":"80px",align:"right"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"流程名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入流程名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1)],1),o("el-col",{staticClass:"btn-container",attrs:{span:18}},[o("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:e.openNewDialog}},[e._v("新建流程")]),o("el-button",{attrs:{size:"mini",icon:"el-icon-search",type:"primary"},on:{click:e.search}},[e._v("查询")]),o("el-button",{attrs:{size:"mini",icon:"el-icon-refresh"},on:{click:function(t){return e.search("reset")}}},[e._v("重置")])],1)],1)],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"row-key":"id",stripe:"",data:e.list}},e._l(e.tableColumns,(function(t){return o("el-table-column",e._b({key:t.prop,scopedSlots:e._u([{key:"default",fn:function(r){return["index"===t.prop?o("div",[e._v(e._s(r.$index+1))]):"operation"===t.prop?o("div",{staticClass:"operation-btn"},[o("el-button",{attrs:{size:"mini",icon:"el-icon-setting",type:"text"},on:{click:function(t){return e.editFlowDialog(r.row.deploymentId,r.row.name,r.row.key)}}},[e._v("设计流程 ")]),o("el-button",{attrs:{size:"mini",icon:"el-icon-edit",type:"text"},on:{click:function(t){return e.editSort(r.row.id,r.row.name,r.row.engineVersion,r.row.key)}}},[e._v("业务配置 ")]),o("el-popconfirm",{attrs:{title:"您确定要删除吗？"},on:{confirm:function(t){return e.deleteById(r.row)}}},[o("el-button",{staticClass:"btn-danger",attrs:{slot:"reference",size:"mini",icon:"el-icon-delete",type:"text"},slot:"reference"},[e._v("删除 ")])],1)],1):o("span",[e._v(e._s(r.row[t.prop]))])]}}],null,!0)},"el-table-column",t,!1))})),1),o("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.searchForm.pageNumber,limit:e.searchForm.pageSize},on:{"update:page":function(t){return e.$set(e.searchForm,"pageNumber",t)},"update:limit":function(t){return e.$set(e.searchForm,"pageSize",t)},pagination:e.getList}}),1==e.dialogVisible?o("el-drawer",{staticClass:"flow-design",attrs:{title:"流程设计图",visible:e.dialogVisible,size:"100%","append-to-body":!1,direction:"btt","destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t},close:e.cloaseDialog}},[o("vue-Bpmn",{attrs:{processId:e.processId,deployMName:e.deployMName,deployMId:e.deployMId,product:"activiti"}})],1):e._e(),1==e.dialogNewSortVisible?o("el-drawer",{attrs:{title:e.title,"close-on-click-modal":!1,visible:e.dialogNewSortVisible,"close-on-press-escape":!1,"destroy-on-close":"",size:"60%"},on:{"update:visible":function(t){e.dialogNewSortVisible=t},close:e.cloaseSortDialog}},[o("div",{staticClass:"drawer-content"},[o("el-form",{ref:"ruleForm",staticStyle:{width:"95%"},attrs:{"label-suffix":"：","label-width":"90px",model:e.ruleForm}},[o("el-form-item",{attrs:{label:"流程名称",prop:"name"}},[o("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),o("el-form-item",{attrs:{label:"所属类别",prop:"flowSort"}},[o("select-tree",{staticClass:"tree",attrs:{data:e.sortData,placeholder:"请选择所属类别"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),o("el-form-item",{attrs:{label:"表单类型",prop:"form_type"}},[o("el-select",{on:{change:function(t){return e.updateElementTask("form_type")}},model:{value:e.ruleForm.form_type,callback:function(t){e.$set(e.ruleForm,"form_type",t)},expression:"ruleForm.form_type"}},[o("el-option",{attrs:{label:"内置表单",value:"0"}}),o("el-option",{attrs:{label:"外部表单",value:"1"}})],1)],1),"0"==e.taskFormtype?o("el-form-item",{attrs:{prop:"formMap",label:"流程表单"}},[o("el-select",{attrs:{filterable:""},on:{change:e.updateAttrs},model:{value:e.ruleForm.formMap,callback:function(t){e.$set(e.ruleForm,"formMap",t)},expression:"ruleForm.formMap"}},e._l(e.formMapList,(function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1):e._e(),"1"==e.taskFormtype?o("el-form-item",{attrs:{prop:"form_url",label:"表单地址"}},[o("el-input",{on:{change:function(t){return e.updateElementTask("form_url")}},model:{value:e.ruleForm.form_url,callback:function(t){e.$set(e.ruleForm,"form_url",t)},expression:"ruleForm.form_url"}})],1):e._e(),o("el-form-item",["0"==e.taskFormtype?o("div",[o("div",{staticClass:"element-drawer__button"},[o("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-view"},on:{click:function(t){return e.openView()}}},[e._v("查看表单 ")])],1)]):e._e()])],1)],1),o("div",{staticClass:"drawer-footer"},[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveEdit}},[e._v("保存")]),o("el-button",{attrs:{size:"mini"},on:{click:e.cloaseSortDialog}},[e._v("取消")])],1)]):e._e(),o("el-drawer",{staticClass:"radius",attrs:{visible:e.viewVisible,title:"表单预览",size:"95%","append-to-body":!1,direction:"btt","destroy-on-close":""},on:{"update:visible":function(t){e.viewVisible=t}}},[o("preview",{attrs:{itemList:e.itemList,dataJson:[],formConf:e.formConf}})],1)],1)])},i=[],s=o("c7eb"),a=o("1da1"),n=(o("b0c0"),o("b64b"),o("4de4"),o("d3b7"),o("ac1f"),o("841c"),o("3335")),l=o("5785"),c=o("7f1c"),u=o("2f2f"),m=o("550a"),d=o("333d"),p=o("8fc7"),f=o("0076"),b=o("fb36"),h={name:"flowDefinition",components:{Pagination:d["a"],VueBpmn:n["default"],preview:l["a"],SelectTree:b["a"]},data:function(){return{dialogVisible:!1,dialogNewSortVisible:!1,formMapList:[],viewVisible:!1,deployMId:"",deployMName:"",processId:"",taskFormtype:"",mapJson:"",itemList:[],formConf:Object,value:null,sortData:[],title:"",colorList:p["a"],tabList:[],activeName:"",tableColumns:f["flowDefinitionColumns"],list:[],total:0,listLoading:!1,searchForm:{pageNumber:1,pageSize:10,name:""},ruleForm:{id:"",name:"",formType:"",formMap:"",form_url:"",sortId:this.value,processKey:""}}},created:function(){this.getList(),this.getSelectData(),this.flowSortTree(),this.loadFormList()},methods:{getList:function(){var e=this;this.listLoading=!0,Object(u["d"])(this.searchForm).then((function(t){200===t.code?(e.list=t.rows,e.total=t.total):e.$message.error("获取列表失败"),e.listLoading=!1}))},loadFormList:function(){var e=this,t={name:"",form_type:"",page:1,pagesize:0};Object(m["d"])(t).then((function(t){"200"==t.code?e.formMapList=t.rows:e.$message.error("获取失败"),e.loading=!1}))},flowSortTree:function(){var e=this;Object(c["b"])().then((function(t){"200"==t.code&&(e.sortData=t.result)}))},openNewDialog:function(){this.dialogVisible=!0,this.deployMId="",this.deployMName="",this.processId=""},editFlowDialog:function(e,t,o){this.dialogVisible=!0,this.deployMId=e,this.deployMName=t,this.processId=o},updateElementTask:function(e){"form_type"!=e&&"form_url"!=e||(this.taskFormtype=this.ruleForm[e])},cloaseDialog:function(){this.deploy()},deploy:function(){this.getList(),this.getSelectData()},cloaseSortDialog:function(){this.dialogNewSortVisible=!1,this.deploy()},saveEdit:function(){var e=this;this.ruleForm.sortId=this.value,Object(u["f"])(this.ruleForm).then((function(t){"200"==t.code?(e.$message.success("修改成功"),e.dialogNewSortVisible=!1,setTimeout((function(){e.deploy()}),1e3)):e.$message.error("获取失败")}))},editSort:function(e,t,o,r){var i=this;if(this.title="业务配置",this.ruleForm.name=t,this.ruleForm.id=e,this.ruleForm.processKey=r,0==o||null==o)this.ruleForm.sortId=null,this.value=null;else{var s=o-0;this.ruleForm.sortId=s,this.value=s}Object(u["c"])({processKey:r}).then((function(e){return"200"!=e.code||""==e.result||void 0==e.result?(i.mapJson="",i.ruleForm.form_type="",i.ruleForm.formMap="",i.ruleForm.form_url="",i.taskFormtype="",void(i.dialogNewSortVisible=!0)):(""==e.result.mapJson||void 0==e.result.mapJson?i.mapJson="":i.mapJson=JSON.parse(e.result.mapJson),i.ruleForm.form_type=e.result.form_type,i.ruleForm.formMap=e.result.formMap,i.ruleForm.form_url=e.result.form_url,i.taskFormtype=e.result.form_type,void(i.dialogNewSortVisible=!0))}))},updateAttrs:function(){var e=this,t=this.formMapList.filter((function(t){if(t.id==e.ruleForm.formMap)return t}));void 0!=t[0].form_json?this.mapJson=JSON.parse(t[0].form_json):this.mapJson=void 0},openView:function(){var e=this;Object(m["g"])({id:this.ruleForm.formMap}).then((function(t){if("200"==t.code){if(e.mapJson=JSON.parse(t.result.form_json),void 0==e.mapJson)return void e.$message.error("表单内容为空");if(e.mapJson==[])return void e.$message.error("请选择表单");e.formConf=e.mapJson.config,e.itemList=e.mapJson.list,e.viewVisible=!0}else e.$message.error("获取失败")}))},search:function(e){"reset"===e&&this.$refs.form.resetFields(),this.searchForm.page=1,this.getList()},onChangeType:function(e){this.search()},getSelectData:function(){var e=this;return Object(a["a"])(Object(s["a"])().mark((function t(){var o;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["b"])();case 2:o=t.sent.data,o.length&&(e.tabList=o,e.activeName=e.tabList[0].id+"");case 4:case"end":return t.stop()}}),t)})))()},deleteById:function(e){var t=this;return Object(a["a"])(Object(s["a"])().mark((function o(){var r;return Object(s["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,Object(u["e"])({depID:e.deploymentID});case 2:r=o.sent,200===r.code?(t.$message.success("删除成功"),t.search("reset")):t.$message.error("删除失败");case 4:case"end":return o.stop()}}),o)})))()}}},v=h,g=(o("3956"),o("2877")),y=Object(g["a"])(v,r,i,!1,null,"668312b2",null);t["default"]=y.exports},3956:function(e,t,o){"use strict";o("d8b6")},"7f1c":function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return a}));var r=o("b775");function i(){return Object(r["a"])({url:"/flowSort/getTree",method:"get"})}function s(e){return Object(r["a"])({url:"/flowSort/save",method:"post",data:e})}function a(e){return Object(r["a"])({url:"/flowSort/"+e,method:"delete"})}},"8fc7":function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return i}));var r={add:"新增",edit:"编辑",view:"查看"},i=["#3D96F9","#F5B658","#42DDA9","#B48BE4","#C55A5A"]},d8b6:function(e,t,o){}}]);